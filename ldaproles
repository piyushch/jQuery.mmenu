If the logs show only ‚ÄúObtained lock for identity [username]‚Äù but you‚Äôre still unable to log in, it suggests that:
	1.	The user is found in LDAP, and authentication is likely successful, but
	2.	The user might not have the required roles to access the Management Console.

üîπ Step 1: Check Role Mapping

Since JBoss Elytron requires users to have specific roles for Management Console access, verify the assigned roles.

Run the following command in the JBoss CLI to check if the roles are correctly mapped:

/subsystem=elytron/security-domain=ManagementDomain:read-resource(include-runtime=true)

Look for:
	‚Ä¢	role-decoder value (should be groups-to-roles or a custom role mapper).
	‚Ä¢	Assigned roles under realms.

If roles are missing, check the role mapping configuration in the LDAP realm.

üîπ Step 2: Manually Check the User‚Äôs Groups

If the role-decoder is groups-to-roles, verify if the user is assigned any roles by running an LDAP query:

ldapsearch -x -LLL -H ldap://<LDAP_SERVER>:389 -D "cn=admin,dc=example,dc=com" -w <LDAP_PASSWORD> -b "ou=groups,dc=example,dc=com" "(member=uid=<LDAP_USERNAME>,ou=users,dc=example,dc=com)"

This should return the groups the user belongs to.

üîπ Step 3: Verify Required Roles for Management Console

JBoss requires at least one of these roles to access the Management Console:
	‚Ä¢	Administrator
	‚Ä¢	SuperUser
	‚Ä¢	Monitor
	‚Ä¢	Auditor
	‚Ä¢	Deployer

If the user does not have a mapped role, update your LDAP role mapping in Elytron:

/subsystem=elytron/security-domain=ManagementDomain:write-attribute(name=role-decoder, value=groups-to-roles)

Then reload the configuration:

reload

üîπ Step 4: Assign a Static Role (For Testing)

If LDAP role mapping isn‚Äôt working as expected, try assigning a static role in Elytron for debugging:

/subsystem=elytron/security-role-mapper=StaticAdminRole:add(roles=[Administrator])
/subsystem=elytron/security-domain=ManagementDomain:write-attribute(name=realms, value=[{realm=LDAPRealm, role-mapper=StaticAdminRole}])
reload

Now, try logging in again.

‚úÖ Next Steps
	1.	Check LDAP role mapping (role-decoder) in ManagementDomain.
	2.	Run ldapsearch to verify the user‚Äôs groups.
	3.	Ensure the user has a required role (Administrator, SuperUser, etc.)
	4.	Try assigning a static role for testing.

Let me know what you find in these checks! üöÄ









To grant the SuperUser role to all users authenticated via LDAP in JBoss EAP 8, you need to configure a constant-role-mapper in Elytron. This will ensure that any user logging in via LDAP automatically gets the SuperUser role.

üîπ Step 1: Create a Constant Role Mapper

This will map all LDAP-authenticated users to the SuperUser role.

Run the following command in the JBoss CLI:

/subsystem=elytron/constant-role-mapper=AllUsersSuperUser:add(roles=[SuperUser])

üîπ Step 2: Assign Role Mapper to the Security Domain

Now, apply this role mapper to your security domain (typically ManagementDomain):

/subsystem=elytron/security-domain=ManagementDomain:write-attribute(name=realms, value=[{realm=LDAPRealm, role-mapper=AllUsersSuperUser}])

üîπ Step 3: Reload the Configuration

Apply the changes by reloading JBoss:

reload

‚úÖ Summary

Step	Command	Purpose
Create Role Mapper	/subsystem=elytron/constant-role-mapper=AllUsersSuperUser:add(roles=[SuperUser])	Assigns SuperUser role to all users
Apply to Security Domain	/subsystem=elytron/security-domain=ManagementDomain:write-attribute(name=realms, value=[{realm=LDAPRealm, role-mapper=AllUsersSuperUser}])	Uses the role mapper in LDAP realm
Reload	reload	Apply changes

Now, any LDAP-authenticated user will automatically have the SuperUser role and should be able to log in to the Management Console.

Try logging in and let me know if you need further tweaks! üöÄ